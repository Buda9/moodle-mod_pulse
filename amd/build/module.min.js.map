{"version":3,"sources":["../src/module.js"],"names":["define","init","module","templatevars","document","getElementsByClassName","l","length","addEventListener","EditorInput","getElementById","insertCaretActive","notificationheader","notificationfooter","clickforword","i","e","preventDefault","insertAtCaret","getAttribute","querySelector","textNodes","getAllTextNodes","forEach","node","span","createElement","classList","after","appendChild","caret","j","remove","add","element","Array","from","childNodes","filter","nodeType","textContent","trim","myValue","caretelements","sel","range","n","thiselem","value","window","getSelection","getRangeAt","rangeCount","deleteContents","insertNode","createTextNode","position","modify","selection","createRange","text","focus","selectionStart","startPos","endPos","selectionEnd","substring"],"mappings":"AAyBAA,OAAM,oBAAC,EAAD,CAAK,UAAW,CAElB,MAAO,CAKHC,IAAI,CAAE,eAAW,CAGb,OAFIC,CAAAA,CAAM,CAAG,IAEb,CADIC,CAAY,CAAGC,QAAQ,CAACC,sBAAT,CAAgC,8BAAhC,CACnB,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGH,CAAY,CAACI,MAAjC,CAAyCD,CAAC,EAA1C,CAA8C,CAC1CH,CAAY,CAACG,CAAD,CAAZ,CAAgBE,gBAAhB,CAAiC,OAAjC,CAA0C,UAAW,CACjD,GAAIC,CAAAA,CAAW,CAAGL,QAAQ,CAACM,cAAT,CAAwB,iCAAxB,CAAlB,CACAR,CAAM,CAACS,iBAAP,CAAyBF,CAAzB,CACH,CAHD,CAIH,CACD,GAAIG,CAAAA,CAAkB,CAAGR,QAAQ,CAACM,cAAT,CAAwB,0BAAxB,CAAzB,CACA,GAA2B,IAAvB,GAAAE,CAAJ,CAAiC,CAC7BA,CAAkB,CAACJ,gBAAnB,CAAoC,OAApC,CAA6C,UAAW,CACpD,GAAIC,CAAAA,CAAW,CAAGL,QAAQ,CAACM,cAAT,CAAwB,2CAAxB,CAAlB,CACAR,CAAM,CAACS,iBAAP,CAAyBF,CAAzB,CACH,CAHD,CAIH,CAED,GAAII,CAAAA,CAAkB,CAAGT,QAAQ,CAACM,cAAT,CAAwB,0BAAxB,CAAzB,CACA,GAA2B,IAAvB,GAAAG,CAAJ,CAAiC,CAC7BA,CAAkB,CAACL,gBAAnB,CAAoC,OAApC,CAA6C,UAAW,CACpD,GAAIC,CAAAA,CAAW,CAAGL,QAAQ,CAACM,cAAT,CAAwB,2CAAxB,CAAlB,CACAR,CAAM,CAACS,iBAAP,CAAyBF,CAAzB,CACH,CAHD,CAIH,CAGD,OADIK,CAAAA,CAAY,CAAGV,QAAQ,CAACC,sBAAT,CAAgC,cAAhC,CACnB,CAASU,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,CAAY,CAACP,MAAjC,CAAyCQ,CAAC,EAA1C,CAA8C,CAC1CD,CAAY,CAACC,CAAD,CAAZ,CAAgBP,gBAAhB,CAAiC,OAAjC,CAA0C,SAASQ,CAAT,CAAY,CAClDA,CAAC,CAACC,cAAF,GACAf,CAAM,CAACgB,aAAP,CAAqB,IAAM,KAAKC,YAAL,CAAkB,WAAlB,CAAN,CAAuC,GAA5D,CACH,CAHD,CAIH,CAGD,GAAsD,IAAlD,GAAAf,QAAQ,CAACM,cAAT,CAAwB,oBAAxB,GAC2F,IADjC,GAAAN,QAAQ,CAACM,cAAT,CAAwB,oBAAxB,EACzDU,aADyD,CAC3C,sEAD2C,CAA9D,CACqG,CACjG,GAAMC,CAAAA,CAAS,CAAG,KAAKC,eAAL,CACdlB,QAAQ,CAACM,cAAT,CAAwB,oBAAxB,EACCU,aADD,CACe,sEADf,CADc,CAAlB,CAIAC,CAAS,CAACE,OAAV,CAAkB,SAAAC,CAAI,CAAI,CACtB,GAAMC,CAAAA,CAAI,CAAGrB,QAAQ,CAACsB,aAAT,CAAuB,MAAvB,CAAb,CACAD,CAAI,CAACE,SAAL,CAAiB,yCAAjB,CACAH,CAAI,CAACI,KAAL,CAAWH,CAAX,EACAA,CAAI,CAACI,WAAL,CAAiBL,CAAjB,CACH,CALD,CAMH,CACJ,CApDE,CAsDHb,iBAAiB,CAAE,2BAASF,CAAT,CAAsB,CAErC,OADIqB,CAAAA,CAAK,CAAG1B,QAAQ,CAACC,sBAAT,CAAgC,qBAAhC,CACZ,CAAS0B,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,CAAK,CAACvB,MAA1B,CAAkCwB,CAAC,EAAnC,CAAuC,CACnCD,CAAK,CAACC,CAAD,CAAL,CAASJ,SAAT,CAAmBK,MAAnB,CAA0B,qBAA1B,CACH,CACDvB,CAAW,CAACkB,SAAZ,CAAsBM,GAAtB,CAA0B,qBAA1B,CACH,CA5DE,CAmEHX,eAAe,CAAE,yBAASY,CAAT,CAAkB,CAC/B,MAAOC,CAAAA,KAAK,CAACC,IAAN,CAAWF,CAAO,CAACG,UAAnB,EACNC,MADM,CACC,SAAAd,CAAI,QAAsB,EAAlB,GAAAA,CAAI,CAACe,QAAL,EAAwD,CAAjC,CAAAf,CAAI,CAACgB,WAAL,CAAiBC,IAAjB,GAAwBlC,MAAnD,CADL,CAEV,CAtEE,CA4EHW,aAAa,CAAE,uBAASwB,CAAT,CAAkB,CAG7B,OAFIC,CAAAA,CAAa,CAAGvC,QAAQ,CAACC,sBAAT,CAAgC,qBAAhC,CAEpB,CADIuC,CACJ,CADSC,CACT,CAASC,CAAC,CAAG,CAAb,CACQC,CADR,CAAgBD,CAAC,CAAGH,CAAa,CAACpC,MAAlC,CAA0CuC,CAAC,EAA3C,CAA+C,CACvCC,CADuC,CAC5BJ,CAAa,CAACG,CAAD,CADe,CAG3C,GAA8B,WAA1B,QAAOC,CAAAA,CAAQ,CAACC,KAAhB,EAAyCC,MAAM,CAACC,YAApD,CAAkE,CAC9DN,CAAG,CAAGK,MAAM,CAACC,YAAP,EAAN,CACA,GAAIN,CAAG,CAACO,UAAJ,EAAkBP,CAAG,CAACQ,UAA1B,CAAsC,CAClCP,CAAK,CAAGD,CAAG,CAACO,UAAJ,CAAe,CAAf,CAAR,CACAN,CAAK,CAACQ,cAAN,GACAR,CAAK,CAACS,UAAN,CAAiBlD,QAAQ,CAACmD,cAAT,CAAwBb,CAAxB,CAAjB,EAEA,IAAK,GAAIc,CAAAA,CAAQ,CAAG,CAApB,CAAuBA,CAAQ,EAAKd,CAAO,CAACnC,MAAR,CAAiB,CAArD,CAAyDiD,CAAQ,EAAjE,CAAqE,CACjEZ,CAAG,CAACa,MAAJ,CAAW,MAAX,CAAmB,OAAnB,CAA4B,WAA5B,CACH,CACJ,CACJ,CAXD,IAWO,IAA8B,WAA1B,QAAOV,CAAAA,CAAQ,CAACC,KAAhB,EAAyC5C,QAAQ,CAACsD,SAAlD,EAA+DtD,QAAQ,CAACsD,SAAT,CAAmBC,WAAtF,CAAmG,CACtGd,CAAK,CAAGzC,QAAQ,CAACsD,SAAT,CAAmBC,WAAnB,EAAR,CACAd,CAAK,CAACe,IAAN,CAAalB,CAChB,CAED,GAA8B,WAA1B,QAAOK,CAAAA,CAAQ,CAACC,KAApB,CAA2C,CACvC,GAAI5C,QAAQ,CAACsD,SAAb,CAAwB,CAEpBX,CAAQ,CAACc,KAAT,GACAjB,CAAG,CAAGxC,QAAQ,CAACsD,SAAT,CAAmBC,WAAnB,EAAN,CACAf,CAAG,CAACgB,IAAJ,CAAWlB,CAAX,CACAK,CAAQ,CAACc,KAAT,EACH,CAND,IAMO,IAAId,CAAQ,CAACe,cAAT,EAAsD,GAA3B,EAAAf,CAAQ,CAACe,cAAxC,CAA+D,IAE9DC,CAAAA,CAAQ,CAAGhB,CAAQ,CAACe,cAF0C,CAG9DE,CAAM,CAAGjB,CAAQ,CAACkB,YAH4C,CAIlElB,CAAQ,CAACC,KAAT,CAAiBD,CAAQ,CAACC,KAAT,CAAekB,SAAf,CAAyB,CAAzB,CAA4BH,CAA5B,EACXrB,CADW,CACDK,CAAQ,CAACC,KAAT,CAAekB,SAAf,CAAyBF,CAAzB,CAAiCjB,CAAQ,CAACC,KAAT,CAAezC,MAAhD,CADhB,CAEAwC,CAAQ,CAACc,KAAT,GACAd,CAAQ,CAACe,cAAT,CAA0BC,CAAQ,CAAGrB,CAAO,CAACnC,MAA7C,CACAwC,CAAQ,CAACkB,YAAT,CAAwBF,CAAQ,CAAGrB,CAAO,CAACnC,MAA3C,CACAwC,CAAQ,CAACc,KAAT,EACH,CAVM,IAUA,CACHd,CAAQ,CAACC,KAAT,EAAkBN,CAAlB,CACAK,CAAQ,CAACc,KAAT,EACH,CACJ,CACJ,CACJ,CAzHE,CA2HV,CA7HK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module javascript to place the placeholders.\r\n * Modified version of IOMAD Email template emailvars.\r\n *\r\n * @module   mod_pulse/module\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([], function() {\r\n\r\n    return {\r\n\r\n        /**\r\n         * Setup the classes to editors works with placeholders.\r\n         */\r\n        init: function() {\r\n            var module = this;\r\n            var templatevars = document.getElementsByClassName(\"fitem_id_templatevars_editor\");\r\n            for (var l = 0; l < templatevars.length; l++) {\r\n                templatevars[l].addEventListener('click', function() {\r\n                    var EditorInput = document.getElementById('id_pulse_content_editoreditable');\r\n                    module.insertCaretActive(EditorInput);\r\n                });\r\n            }\r\n            var notificationheader = document.getElementById('admin-notificationheader');\r\n            if (notificationheader !== null) {\r\n                notificationheader.addEventListener('click', function() {\r\n                    var EditorInput = document.getElementById('id_s_mod_pulse_notificationheadereditable');\r\n                    module.insertCaretActive(EditorInput);\r\n                });\r\n            }\r\n\r\n            var notificationfooter = document.getElementById('admin-notificationfooter');\r\n            if (notificationfooter !== null) {\r\n                notificationfooter.addEventListener('click', function() {\r\n                    var EditorInput = document.getElementById('id_s_mod_pulse_notificationfootereditable');\r\n                    module.insertCaretActive(EditorInput);\r\n                });\r\n            }\r\n\r\n            var clickforword = document.getElementsByClassName('clickforword');\r\n            for (var i = 0; i < clickforword.length; i++) {\r\n                clickforword[i].addEventListener('click', function(e) {\r\n                    e.preventDefault(); // To prevent the default behaviour of a tag.\r\n                    module.insertAtCaret(\"{\" + this.getAttribute('data-text') + \"}\");\r\n                });\r\n            }\r\n\r\n            // Make selected roles as badges in module edit form page.\r\n            if (document.getElementById('page-mod-pulse-mod') !== null && document.getElementById('page-mod-pulse-mod')\r\n                .querySelector(\"#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']\") !== null) {\r\n                const textNodes = this.getAllTextNodes(\r\n                    document.getElementById('page-mod-pulse-mod')\r\n                    .querySelector(\"#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']\")\r\n                );\r\n                textNodes.forEach(node => {\r\n                    const span = document.createElement('span');\r\n                    span.classList = 'badge badge-info pulse-completion-roles';\r\n                    node.after(span);\r\n                    span.appendChild(node);\r\n                });\r\n            }\r\n        },\r\n\r\n        insertCaretActive: function(EditorInput) {\r\n            var caret = document.getElementsByClassName(\"insertatcaretactive\");\r\n            for (var j = 0; j < caret.length; j++) {\r\n                caret[j].classList.remove(\"insertatcaretactive\");\r\n            }\r\n            EditorInput.classList.add(\"insertatcaretactive\");\r\n        },\r\n\r\n        /**\r\n         * Filter text from node.\r\n         * @param  {string} element\r\n         * @returns {array} list of childNodes.\r\n         */\r\n        getAllTextNodes: function(element) {\r\n            return Array.from(element.childNodes)\r\n            .filter(node => node.nodeType === 3 && node.textContent.trim().length > 1);\r\n        },\r\n\r\n        /**\r\n         * Insert the placeholder in selected caret place.\r\n         * @param  {string} myValue\r\n         */\r\n        insertAtCaret: function(myValue) {\r\n            var caretelements = document.getElementsByClassName(\"insertatcaretactive\");\r\n            var sel, range;\r\n            for (var n = 0; n < caretelements.length; n++) {\r\n                var thiselem = caretelements[n];\r\n\r\n                if (typeof thiselem.value === 'undefined' && window.getSelection) {\r\n                    sel = window.getSelection();\r\n                    if (sel.getRangeAt && sel.rangeCount) {\r\n                        range = sel.getRangeAt(0);\r\n                        range.deleteContents();\r\n                        range.insertNode(document.createTextNode(myValue));\r\n\r\n                        for (let position = 0; position != (myValue.length + 1); position++) {\r\n                            sel.modify(\"move\", \"right\", \"character\");\r\n                        }\r\n                    }\r\n                } else if (typeof thiselem.value === 'undefined' && document.selection && document.selection.createRange) {\r\n                    range = document.selection.createRange();\r\n                    range.text = myValue;\r\n                }\r\n\r\n                if (typeof thiselem.value !== 'undefined') {\r\n                    if (document.selection) {\r\n                        // For browsers like Internet Explorer.\r\n                        thiselem.focus();\r\n                        sel = document.selection.createRange();\r\n                        sel.text = myValue;\r\n                        thiselem.focus();\r\n                    } else if (thiselem.selectionStart || thiselem.selectionStart == '0') {\r\n                        // For browsers like Firefox and Webkit based.\r\n                        var startPos = thiselem.selectionStart;\r\n                        var endPos = thiselem.selectionEnd;\r\n                        thiselem.value = thiselem.value.substring(0, startPos)\r\n                            + myValue + thiselem.value.substring(endPos, thiselem.value.length);\r\n                        thiselem.focus();\r\n                        thiselem.selectionStart = startPos + myValue.length;\r\n                        thiselem.selectionEnd = startPos + myValue.length;\r\n                        thiselem.focus();\r\n                    } else {\r\n                        thiselem.value += myValue;\r\n                        thiselem.focus();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n    };\r\n});\r\n"],"file":"module.min.js"}