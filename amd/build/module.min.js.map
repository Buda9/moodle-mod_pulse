{"version":3,"sources":["../src/module.js"],"names":["define","init","module","templatevars","document","getElementsByClassName","console","log","l","length","addEventListener","EditorInput","getElementById","caret","j","classList","remove","add","clickforword","i","e","preventDefault","insertAtCaret","getAttribute","textNodes","getAllTextNodes","querySelector","forEach","node","span","createElement","after","appendChild","element","Array","from","childNodes","filter","nodeType","textContent","trim","myValue","caretelements","n","thiselem","value","sel","range","window","getSelection","getRangeAt","rangeCount","deleteContents","insertNode","createTextNode","position","modify","selection","createRange","text","focus","selectionStart","startPos","endPos","selectionEnd","scrollTop","substring"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module javascript to place the placeholders.\r\n * Modified version of IOMAD Email template emailvars.\r\n *\r\n * @package   mod_pulse\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine([], function() {\r\n\r\n    return {\r\n\r\n        init: function() {\r\n            var module = this;\r\n            var templatevars = document.getElementsByClassName(\"fitem_id_templatevars_editor\");\r\n            console.log(templatevars);\r\n            for (var l = 0; l < templatevars.length; l++) {\r\n                templatevars[l].addEventListener('click', function() {\r\n                    var EditorInput = document.getElementById('id_pulse_content_editoreditable');\r\n                    var caret = document.getElementsByClassName(\"insertatcaretactive\");\r\n                    for (j = 0; j < caret.length; j++) {\r\n                        caret[j].classList.remove(\"insertatcaretactive\");\r\n                    }\r\n                    EditorInput.classList.add(\"insertatcaretactive\");\r\n\r\n                });\r\n            }\r\n            var clickforword = document.getElementsByClassName('clickforword');\r\n            for (var i = 0; i < clickforword.length; i++) {\r\n                clickforword[i].addEventListener('click', function(e) {\r\n                    e.preventDefault(); // To prevent the default behaviour of a tag.\r\n                    module.insertAtCaret(\"{\" + this.getAttribute('data-text') + \"}\");\r\n                });\r\n            }\r\n\r\n            // Make selected roles as badges in module edit form page.\r\n            const textNodes = this.getAllTextNodes(document.getElementById('page-mod-pulse-mod').querySelector(\"#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']\"));\r\n            textNodes.forEach(node => {\r\n                const span = document.createElement('span');\r\n                span.classList = 'badge badge-info pulse-completion-roles';\r\n                node.after(span);\r\n                span.appendChild(node);\r\n            });\r\n        },\r\n\r\n        // Filter text from node.\r\n        getAllTextNodes: function(element) {\r\n            return Array.from(element.childNodes)\r\n            .filter(node => node.nodeType === 3 && node.textContent.trim().length > 1);\r\n        },\r\n\r\n\r\n        insertAtCaret: function(myValue) {\r\n            var caretelements = document.getElementsByClassName(\"insertatcaretactive\");\r\n            for (var n = 0; n < caretelements.length; n++) {\r\n                var thiselem = caretelements[n];\r\n                if (typeof thiselem.value === 'undefined') {\r\n                    var sel, range, html;\r\n                    if (window.getSelection) {\r\n                        sel = window.getSelection();\r\n                        if (sel.getRangeAt && sel.rangeCount) {\r\n                            range = sel.getRangeAt(0);\r\n                            range.deleteContents();\r\n                            range.insertNode(document.createTextNode(myValue));\r\n\r\n                            for (let position = 0; position != (myValue.length + 1); position++) {\r\n                                sel.modify(\"move\", \"right\", \"character\");\r\n                            }\r\n                        }\r\n                    } else if (document.selection && document.selection.createRange) {\r\n                        range = document.selection.createRange();\r\n                        range.text = myValue;\r\n                    }\r\n                } else {\r\n                    if (document.selection) {\r\n                        // For browsers like Internet Explorer.\r\n                        thiselem.focus();\r\n                        sel = document.selection.createRange();\r\n                        sel.text = myValue;\r\n                        thiselem.focus();\r\n                    } else if (thiselem.selectionStart || thiselem.selectionStart == '0') {\r\n                        // For browsers like Firefox and Webkit based.\r\n                        var startPos = thiselem.selectionStart;\r\n                        var endPos = thiselem.selectionEnd;\r\n                        var scrollTop = thiselem.scrollTop;\r\n                        thiselem.value = thiselem.value.substring(0, startPos) + myValue + thiselem.value.substring(endPos, thiselem.value.length);\r\n                        thiselem.focus();\r\n                        thiselem.selectionStart = startPos + myValue.length;\r\n                        thiselem.selectionEnd = startPos + myValue.length;\r\n                        thiselem.focus();\r\n                    } else {\r\n                        thiselem.value += myValue;\r\n                        thiselem.focus();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n    };\r\n});"],"file":"module.min.js"}