{"version":3,"sources":["../src/preset.js"],"names":["define","$","Modal","ModalPreset","PresetEvents","Str","Fragment","AJAX","Templates","Loadingicon","Notification","ModalEvents","SELECTOR","presetAvailability","Preset","contextId","courseid","section","loadPresetsList","prototype","listElement","pageparams","loadIconElement","actionbuttons","attachToDOM","modal","isAttached","attachmentPoint","append","getRoot","bodyJS","runTemplateJS","footerJS","setupmodal","THIS","triggerelement","document","querySelectorAll","createElement","classList","add","forEach","element","addEventListener","presetid","getAttribute","presettitle","params","body","prepend","create","type","TYPE","title","get_string","large","then","show","loadFragment","html","js","setBody","reinitAvailability","fieldChangedEvent","on","hidden","destroy","customize","modform","querySelector","modformdata","FormData","get","form","formdata","URLSearchParams","toString","addIconToContainer","disableButtons","applyCustomize","save","e","preventDefault","restorePreset","catch","exception","confParam","getElementById","methods","fieldName","changeinput","id","changeName","split","field","event","target","value","reminder","schedule","method","opt","hasOwnProperty","selector","M","core_availability","resetRestrictPlugins","parentNode","removeChild","init","restrictByGroup","availabilityPlugins","plugins","plugin","i","addedEvents","contextID","done","hide","handleFormSubmissionResponse","buttons","$i","disabled","data","newform","innerHTML","replaceNode","contextid","formdatastr","promises","call","methodname","args","response","JSON","parse","url","window","location","href","listParent","loaded","replaceNodeContents","setAttribute"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'mod_pulse/modal_preset', 'mod_pulse/events', 'core/str',\r\n'core/fragment', 'core/ajax', 'core/templates', 'mod_pulse/loadingicon', 'core/notification', 'core/modal_events'],\r\n    function($, Modal, ModalPreset, PresetEvents, Str, Fragment, AJAX, Templates, Loadingicon, Notification, ModalEvents) {\r\n\r\n    var SELECTOR = {\r\n        presetAvailability: '.preset-config-params .availability-field'\r\n    };\r\n\r\n    /**\r\n     * Preset module declaration. Setup the global values.\r\n     * @param  {int} contextId\r\n     * @param  {int} courseid\r\n     * @param  {int} section\r\n     */\r\n    var Preset = function(contextId, courseid, section) {\r\n        this.contextId = contextId;\r\n        this.courseid = courseid;\r\n        this.section = section;\r\n        this.loadPresetsList();\r\n    };\r\n\r\n    Preset.prototype.listElement = {'selector': 'pulse-presets-data', \"loaded\": \"data-listloaded\"};\r\n\r\n    Preset.prototype.contextId = 0;\r\n\r\n    Preset.prototype.courseid = 0;\r\n\r\n    Preset.prototype.section = 0;\r\n\r\n    Preset.prototype.pageparams = [];\r\n\r\n    Preset.prototype.loadIconElement = '.modal-footer #loader-icon';\r\n\r\n    Preset.prototype.actionbuttons = '.modal-footer button';\r\n\r\n        /**\r\n     * Add the modal to the page, if it hasn't already been added. This includes running any\r\n     * javascript that has been cached until now.\r\n     *\r\n     * @method attachToDOM\r\n     */\r\n    Preset.prototype.attachToDOM = function(modal) {\r\n        if (modal.isAttached) {\r\n            return;\r\n        }\r\n\r\n        $(modal.attachmentPoint).append(modal.getRoot());\r\n\r\n        // If we'd cached any JS then we can run it how that the modal is\r\n        // attached to the DOM.\r\n        if (modal.bodyJS) {\r\n            Templates.runTemplateJS(modal.bodyJS);\r\n            modal.bodyJS = null;\r\n        }\r\n\r\n        if (modal.footerJS) {\r\n            Templates.runTemplateJS(modal.footerJS);\r\n            modal.footerJS = null;\r\n        }\r\n\r\n        modal.isAttached = true;\r\n    };\r\n\r\n    /**\r\n     * Setup the presets modal event listeners.\r\n     */\r\n    Preset.prototype.setupmodal = function() {\r\n\r\n        var THIS = this;\r\n\r\n        var triggerelement = document.querySelectorAll('.pulse-usepreset');\r\n        // Modal attachment point.\r\n        var attachmentPoint = document.createElement('div');\r\n        attachmentPoint.classList.add('modal-preset');\r\n        triggerelement.forEach((element) => element.addEventListener('click', () => {\r\n            var presetid = element.getAttribute('data-presetid');\r\n            var presettitle = element.getAttribute('data-presettitle');\r\n            var params = {'presetid': presetid, 'courseid': THIS.courseid, 'section': THIS.section};\r\n\r\n            document.body.prepend(attachmentPoint);\r\n            Modal.create({\r\n                type: ModalPreset.TYPE,\r\n                title: Str.get_string('presetmodaltitle', 'pulse', {'title': presettitle}),\r\n                body: '',\r\n                large: true,\r\n            }).then(modal => {\r\n                // Make the modal attachment point to overcome the restriction access condition.\r\n                modal.attachmentPoint = attachmentPoint;\r\n                THIS.attachToDOM(modal);\r\n                modal.show();\r\n                Fragment.loadFragment('mod_pulse', 'get_preset_preview', THIS.contextId, params).then((html, js) => {\r\n                    modal.setBody(html);\r\n                    Templates.runTemplateJS(js);\r\n                    THIS.reinitAvailability(SELECTOR.presetAvailability);\r\n                    THIS.fieldChangedEvent();\r\n                })\r\n                // Destroy the modal on hidden to reload the editors.\r\n                modal.getRoot().on(ModalEvents.hidden, function() {\r\n                    modal.destroy();\r\n                    THIS.reinitAvailability();\r\n                });\r\n\r\n                // Apply and customize method.\r\n                modal.getRoot().on(PresetEvents.customize, () => {\r\n                    var modform = document.querySelector('#mod-pulse-form');\r\n                    var modformdata = new FormData(modform);\r\n                    modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                        var formdata = new FormData(form);\r\n                        formdata = new URLSearchParams(formdata).toString();\r\n                        var pageparams = new URLSearchParams(modformdata).toString();\r\n                        params = {formdata: formdata, pageparams: pageparams};\r\n\r\n                        Loadingicon.addIconToContainer(this.loadIconElement);\r\n                        THIS.disableButtons();\r\n                        THIS.applyCustomize(params, THIS.contextId, modal);\r\n                    });\r\n                });\r\n                // Apply and save method.\r\n                modal.getRoot().on(PresetEvents.save, (e) => {\r\n                    e.preventDefault();\r\n                    Loadingicon.addIconToContainer(this.loadIconElement);\r\n                    THIS.disableButtons();\r\n                    var formdata = {};\r\n                    modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                        formdata = new FormData(form);\r\n                        this.restorePreset(formdata, THIS.contextId);\r\n                    });\r\n                });\r\n                return true;\r\n            }).catch(Notification.exception);\r\n        }));\r\n    };\r\n\r\n\r\n    Preset.prototype.fieldChangedEvent = () => {\r\n        var confParam = document.getElementById(\"preset-configurable-params\");\r\n        var reminders = ['first', 'second', 'recurring'];\r\n        var methods = ['fixed', 'relative'];\r\n        var fieldName, changeinput, id, changeName, split;\r\n        confParam.querySelectorAll('input, select, textarea').forEach(field => {\r\n            field.addEventListener('change', (event) => {\r\n                fieldName = event.target.getAttribute('name');\r\n                if (confParam.querySelector('input[name=\"' + fieldName + '_changed\"]') !== null) {\r\n                    confParam.querySelector('input[name=\"' + fieldName + '_changed\"]').value = true;\r\n                }\r\n            });\r\n        });\r\n\r\n        reminders.forEach(reminder => {\r\n            confParam.querySelectorAll('[name=\"' + reminder + '_schedule\"').forEach(schedule => {\r\n                schedule.addEventListener('change', (e) => {\r\n                    changeName = e.target.getAttribute('name');\r\n                    changeinput = 'input[name=\"' + changeName + '_arr_changed\"]';\r\n                    confParam.querySelector(changeinput).value = true;\r\n                });\r\n            });\r\n            methods.forEach(method => {\r\n                id = reminder + \"_\" + method + \"date\";\r\n                confParam.querySelectorAll('[name*=\"' + id + '\"]').forEach(opt => {\r\n                    opt.addEventListener('change', (e) => {\r\n                        split = e.target.getAttribute('name').split('[');\r\n                        changeName = (split.hasOwnProperty(1)) ? split[0] : split;\r\n                        changeinput = 'input[name=\"' + changeName + '_changed\"]';\r\n                        confParam.querySelector(changeinput).value = true;\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Reinitialize the availability javascript.\r\n     * @param {string} selector\r\n     */\r\n    Preset.prototype.reinitAvailability = function(selector = '.availability-field') {\r\n        if (typeof M.core_availability.form !== \"undefined\") {\r\n            this.resetRestrictPlugins();\r\n            document.querySelectorAll(selector).forEach((field) => field.parentNode.removeChild(field));\r\n            M.core_availability.form.init();\r\n        }\r\n    };\r\n\r\n    Preset.prototype.resetRestrictPlugins = function() {\r\n        if (typeof M.core_availability.form !== \"undefined\" && document.getElementById('id_availabilityconditionsjson') !== null) {\r\n            M.core_availability.form.restrictByGroup = null;\r\n            var availabilityPlugins = (typeof M.core_availability.form.plugins !== 'undefined')\r\n                ? M.core_availability.form.plugins : {};\r\n            var plugin = '';\r\n            for (var i in availabilityPlugins) {\r\n                plugin = \"availability_\" + i;\r\n                if (M.hasOwnProperty(plugin)) {\r\n                    M[plugin].form.addedEvents = false;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Apply and customize triggered using fragment. Response will replaced with current mod form.\r\n     * @param  {string} params\r\n     * @param  {int} contextID\r\n     * @param  {object} modal\r\n     */\r\n    Preset.prototype.applyCustomize = function(params, contextID, modal) {\r\n        Fragment.loadFragment('mod_pulse', 'apply_preset', contextID, params).done((html, js) => {\r\n            modal.hide();\r\n            modal.destroy();\r\n            // Reset the availability to work for upcoming response html.\r\n            this.resetRestrictPlugins();\r\n            this.handleFormSubmissionResponse(html, js);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Disable the modal save and customize buttons to prevent reinit.\r\n     */\r\n    Preset.prototype.disableButtons = function() {\r\n        var buttons = document.querySelectorAll(this.actionbuttons);\r\n        for (let $i in buttons) {\r\n            buttons[$i].disabled = true;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Handle the loaded fragment output of customize method pulse mod.\r\n     * @param  {html} data\r\n     * @param  {string} js\r\n     */\r\n    Preset.prototype.handleFormSubmissionResponse = (data, js) => {\r\n        var newform = document.createElement('div');\r\n        newform.innerHTML = data;\r\n        Templates.replaceNode('[action=\"modedit.php\"]', data, js);\r\n\r\n    };\r\n\r\n    /**\r\n     * Initiate the apply and save method to create the pulse module with custom daa.\r\n     * @param  {FormData} formdata\r\n     * @param  {int} contextid\r\n     */\r\n    Preset.prototype.restorePreset = (formdata, contextid) => {\r\n        var formdatastr = new URLSearchParams(formdata).toString();\r\n        var promises = AJAX.call([{\r\n            methodname: 'mod_pulse_apply_presets',\r\n            args: {contextid: contextid, formdata: formdatastr}\r\n        }]);\r\n\r\n        promises[0].done((response) => {\r\n            response = JSON.parse(response);\r\n            if (typeof response.url != 'undefined') {\r\n                window.location.href = response.url;\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Load list of available presets.\r\n     */\r\n    Preset.prototype.loadPresetsList = function() {\r\n        var listParent = document.getElementById(this.listElement.selector);\r\n\r\n        if (listParent !== null) {\r\n            if (listParent.getAttribute(this.listElement.loaded) == 'false') {\r\n                Fragment.loadFragment('mod_pulse', 'get_presetslist', this.contextId, {'courseid': this.courseid})\r\n                .done((html, js) => {\r\n                    Templates.replaceNodeContents(listParent, html, js);\r\n                    listParent.setAttribute(this.listElement.loaded, 'true');\r\n                    this.setupmodal();\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    return {\r\n        init: (contextId, courseid, section) => {\r\n            new Preset(contextId, courseid, section);\r\n        }\r\n    };\r\n});\r\n"],"file":"preset.min.js"}